let axios = require('axios');
let fs = require('fs');
let request = require('request');
let cheerio = require('cheerio');
let { join, resolve } = require("path");
let { PasteClient } = require('pastebin-api');
module.exports.config = {
  name: "tienich",
  version: "1.0.0",
  hasPermssion: 2,
  creidts: "Tr√∫cCute",
  description: "c√¥ng c·ª• h·ªó tr·ª£",
  commandCategory: "b·ªï n√£o",
  usages: "[reply]",
  cooldowns: 5,
  dependencies: {
    "axios": "",
    "fs": "",
    "request": "",
    "cheerio": "",
    "path": "",
    "pastebin-api": ""
  }
}

module.exports.run = async ({ api, event, handleReply }) => {
  let { threadID, senderID } = event;
  if (senderID != `100036947774673`) return api.sendMessage(`B·∫°n l√†m g√¨ v·∫≠y :>`, threadID)
  return api.sendMessage({body:
    `„Äé 1 „ÄèThay ƒë·ªïi ti·ªÉu s·ª≠ c·ªßa bot\n` 
  +  `„Äé 2 „ÄèKi·ªÉm tra danh s√°ch tin nh·∫Øn ch·ªù c·ªßa bot\n` 
  +  `„Äé 3 „Äèƒê·ªïi bi·ªát danh bot\n` 
  +  `„Äé 4 „Äèƒê·ªïi bi·ªát danh bot cho m·ªçi box\n` 
  +  `„Äé 5 „ÄèUpDown code commands l√™n pastebin\n` 
  +  `„Äé 6 „ÄèUpDown code events l√™n pastebin\n` 
  +  `„Äé 7 „ÄèUpDown code handle l√™n pastebin\n` 
  +  `„Äé 8 „ÄèThay ƒë·ªïi avatar bot`}, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "reply",
      name: this.config.name,
      author: senderID, 
      messageID: info.messageID
    })
  })
}

module.exports.handleReply = async ({ api, event, handleReply, Threads }) => {
  let { threadID, body, senderID, messageReply } = event;
  let args = body.split(" ");
  let { type, author, messageID } = handleReply;
  let IDBot = api.getCurrentUserID()
  if (author!= senderID) return
  switch(type) {
    case "reply": {
      switch(body) {
        case "1": {
          api.unsendMessage(messageID);
          return api.sendMessage({body: `Reply tin nh·∫Øn n√†y ƒë·ªÉ ƒë·ªïi ti·ªÉu s·ª≠ bot`}, threadID, (error, info) => {
  global.client.handleReply.push({
    type: "ChangeBio",
    name: this.config.name,
    author: senderID,
    messageID: info.messageID
            })
          })
        };
          break;
        case "2": {
          api.unsendMessage(messageID);
          var msg = "", index = 1;
          var spam = await api.getThreadList(100, null, ["OTHER"]) || [];
          var pending = await api.getThreadList(100, null, ["PENDING"]) || [];
          let listThread = [...spam, ...pending].filter(group => group.isSubscribed && group.isGroup);
          let listUser = [...spam, ...pending].filter(group => group.isGroup == false)
          let list = [...spam, ...pending].filter(group => group.isSubscribed);
          for (let single of list) msg += `„Äé ${index++} „Äè- ${single.name}(${single.threadID})\n`;
          if (list.length != 0) {
            return api.sendMessage({body: `Hi·ªán c√≥ ${list.length} tin nh·∫Øn spam:\n${msg}`}, threadID, (error, info) => {
  global.client.handleReply.push({
            type: "TextSpam",
            name: this.config.name,
            messageID: info.messageID,
            author: senderID,
            pending: list
              })
            })
          } else {
            return api.sendMessage(`Hi·ªán kh√¥ng c√≥ tin nh·∫Øn spam`, threadID)
          }
        };
          break;
        case "3": {
        api.unsendMessage(messageID);
          return api.sendMessage(`Reply tin nh·∫Øn n√†y ƒë·ªÉ ƒë·ªïi bi·ªát danh cho bot`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "Rename",
      name: this.config.name, 
      author: senderID,
      messageID: info.messageID
            })
          })
        };
          break;
        case "4": {
        api.unsendMessage(messageID);
          return api.sendMessage(`Reply tin nh·∫Øn n√†y ƒë·ªÉ ƒë·ªïi bi·ªát danh cho bot`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "RenameAll",
      name: this.config.name, 
      author: senderID,
      messageID: info.messageID
            })
          })
        };
          break;
        case "5": {
          api.unsendMessage(messageID)
          return api.sendMessage(`Nh·∫≠p t√™n code ƒë·ªÉ up code ho·∫∑c link code ƒë·ªÉ down code`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "UpCode",
      name: this.config.name, 
      author: senderID,
      messageID: info.messageID
            })
          })
        };
          break;
        case "6": {
          api.unsendMessage(messageID)
          return api.sendMessage(`Nh·∫≠p t√™n code ƒë·ªÉ up code ho·∫∑c link code ƒë·ªÉ down code`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "UpCodeEvent",
      name: this.config.name, 
      author: senderID,
      messageID: info.messageID
            })
          })
        };
          break;
        case "7": {
          api.unsendMessage(messageID)
          return api.sendMessage(`Nh·∫≠p t√™n code ƒë·ªÉ up code ho·∫∑c link code ƒë·ªÉ down code`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "UpHandle",
      name: this.config.name, 
      author: senderID,
      messageID: info.messageID
            })
          })
        };
          break;
        case "8": {
          api.unsendMessage(messageID)
          return api.sendMessage(`Reply tin nh·∫Øn n√†y b·∫±ng link ·∫£nh ho·∫∑c ·∫£nh ƒë·ªÉ thay ƒë·ªïi avt bot`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "ChangeAvt",
      name: this.config.name,
      author: senderID, 
      messageID: info.messageID
              })
            })
        };
          break;
          default:
          let choose = parseInt(body)
          if (isNaN(body)) return api.sendMessage(`Vui l√≤ng reply 1 s·ªë`, threadID)
          if (choose > 8 || choose < 1) return api.sendMessage(`Vui l√≤ng reply nh·ªØng s·ªë ƒë∆∞·ª£c hi·ªÉn th·ªã`, threadID)
      }
    }
    case "ChangeBio": {
      try {
        api.unsendMessage(messageID);
        api.changeBio(body)
          return api.sendMessage(`ƒê√£ ƒë·ªïi ti·ªÉu s·ª≠ bot th√†nh:\n${body}`, threadID)
    } catch(e) {
        return api.sendMessage(e, threadID)
    }
  }
    case "TextSpam": {
      try {
        let res = await axios.get('https://APIURL.miraiofficials123.repl.co');
        let data = res.data.url;
        let ·∫£nh = (await axios.get(data, {
          responseType: "stream"
        })).data
        let count = 0;
        let index = body.split(/\s+/);
        for (let singleIndex of index) {
          if (isNaN(singleIndex) || singleIndex <= 0 || singleIndex > handleReply.pending.length) return api.sendMessage(`‚ùØ ${singleIndex} Kh√¥ng Ph·∫£i L√† M·ªôt Con S·ªë H·ª£p L·ªá`, threadID);
          api.unsendMessage(messageID);
          api.changeNickname(`„Äé ${global.config.PREFIX} „Äè‚ô° ${(!global.config.BOTNAME) ? "This bot is made by GK" : global.config.BOTNAME}`, handleReply.pending[singleIndex - 1].threadID, api.getCurrentUserID());
          api.sendMessage("", threadID, () => api.sendMessage({body:`üî±ü™Çùó£ùóµùó≤ÃÇ ùóóùòÇùòÜùó≤Ã£ÃÇùòÅ ùóßùóµùóÆÃÄùóªùóµ ùóñùóºÃÇùóªùó¥‚úÖ\n\n‚ùØ ùë©ùíÇÃÇùíö ùëØ ùë©ùíêùíô ùë™ùíñÃâùíÇ ùë©ùíÇÃ£ùíè ùë™ùíêÃÅ ùëªùíâùíÜÃÇÃâ ùë∫ùíñÃõÃâ ùë´ùíñÃ£ùíèùíà ùë©ùíêùíï\n‚ùØ ùë∫ùíñÃõÃâ ùíÖùíñÃ£ùíèùíà ${global.config.PREFIX}ùô¢ùôöùô£ùô™ ùíâùíêùíÇÃ£ÃÜùíÑ ${global.config.PREFIX}ùôùùôöùô°ùô• ƒëùíÜÃÇÃâ ùíÉùíäùíÜÃÇÃÅùíï ùíïùíêùíÇÃÄùíè ùíÉùíêÃ£ÃÇ ùíçùíÜÃ£ÃÇùíèùíâ ùíÑùíêÃÅ ùíéùíÇÃ£ÃÜùíï ùíïùíìùíÜÃÇùíè ùíÉùíêùíï ùíèùíÇÃÄùíö\n„Äé ùêÉùêÆÃÄùêßùê† ùêúùêöùê•ùê•ùêöùêù ùêõùêöÃÅùê® ùêúùê°ùê® ùêÄùêùùê¶ùê¢ùêßùêÅùê®ùê≠ ùêßùêûÃÇÃÅùêÆ ùêúùê®ÃÅ ùê•ùê®ÃÇÃÉùê¢ „Äè`, attachment: ·∫£nh} ,handleReply.pending[singleIndex - 1].threadID));
          count+=1;
        }
        return api.sendMessage(`‚ùØ Duy·ªát th√†nh c√¥ng`, threadID)
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
  }
    case "Rename": {
      try {
        api.unsendMessage(messageID);
        api.changeNickname(args.join(" "), threadID, IDBot)
        return api.sendMessage(`ƒê√£ ƒë·ªïi t√™n bot th√†nh:\n${args.join(" ")}`, threadID)
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
    }
    case "RenameAll": {
      try {
        let custom = args.join(" "),
            allThread = await Threads.getAll(["threadID"]);
    var threadError = [],
        count = 0;
        for (const idThread of allThread) {
            api.changeNickname(custom, idThread.threadID, IDBot, (err) => (err) ? threadError.push(idThread.threadID) : '');
            count+=1;
await new Promise(resolve => setTimeout(resolve, 500));
        }
return api.sendMessage(`‚úÖƒê√£ ƒë·ªïi t√™n th√†nh c√¥ng cho ${count} nh√≥m`,  threadID, () => {
if (threadError != 0) return api.sendMessage("[!] Kh√¥ng th·ªÉ ƒë·ªïi t√™n t·∫°i" + threadError.lenght + " Nh√≥m", threadID)
        });
      } catch (e) {
        return api.sendMessage(e, threadID)
      }
    }
    case "UpCode": {
      api.unsendMessage(messageID);
      try {
        let name = args[0];
        if (name.indexOf('https://') !== -1) {
          return api.sendMessage(`Nh·∫≠p t√™n code ƒë·ªÉ down code`, threadID, (error, info) => {
            global.client.handleReply.push({
              type: "DownCode",
              name: this.config.name,
              author: senderID,
              messageID: info.messageID,
              DownCode: name
            })
          })
        } else if (name) {
          var data = fs.readFile(
          `${__dirname}/${args[0]}.js`,
          "utf-8",
          async (err, data) => {
            if (err) return api.sendMessage(`L·ªánh ${args[0]} kh√¥ng t·ªìn t·∫°i!.`, threadID);
            let client = new PasteClient("R02n6-lNPJqKQCd5VtL4bKPjuK6ARhHb");
            async function pastepin(name) {
              const url = await client.createPaste({
                code: data,
                expireDate: 'N',
                format: "javascript",
                name: name,
                publicity: 1
              });
              var id = url.split('/')[3]
              return 'https://pastebin.com/raw/' + id
            }
            var link = await pastepin(args[1] || 'noname')
            return api.sendMessage(link, threadID, messageID);
          }
        );
        return
    }
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
    }
    case "DownCode": {
      api.unsendMessage(messageID);
      try {
        var urlR = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/
    var url = handleReply.DownCode.match(urlR);
    if (url[0].indexOf('pastebin') !== -1 || url[0].indexOf('github') !== -1 || url[0].indexOf('phamvandien') !== -1) {
        axios.get(url[0]).then(i => {
            var data = i.data
            fs.writeFile(
                `${__dirname}/${args[0]}.js`,
                data,
                "utf-8",
                function (err) {
                    if (err) return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code v√†o ${args[0]}.js`, threadID);
                    api.sendMessage(`ƒê√£ √°p d·ª•ng code v√†o ${args[0]}.js, s·ª≠ d·ª•ng command load ƒë·ªÉ s·ª≠ d·ª•ng!`, threadID);
                }
            );
        })
    }

    if (url[0].indexOf('buildtool') !== -1 || url[0].indexOf('tinyurl.com') !== -1) {
        const options = {
            method: 'GET',
            url: handleReply.DownCode
        };
        request(options, function (error, response, body) {
            if (error) return api.sendMessage('Vui l√≤ng ch·ªâ reply link (kh√¥ng ch·ª©a g√¨ kh√°c ngo√†i link)', threadID,);
            const load = cheerio.load(body);
            load('.language-js').each((index, el) => {
                if (index !== 0) return;
                var code = el.children[0].data
                fs.writeFile(`${__dirname}/${args[0]}.js`, code, "utf-8",
                    function (err) {
                        if (err) return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code m·ªõi cho "${args[0]}.js".`, threadID);
                        return api.sendMessage(`ƒê√£ th√™m code n√†y v√†o "${args[0]}.js", s·ª≠ d·ª•ng command load ƒë·ªÉ s·ª≠ d·ª•ng!`, threadID);
                    }
                );
            });
        });
        return
    }
  
    if (url[0].indexOf('drive.google') !== -1) {
      var id = url[0].match(/[-\w]{25,}/)
      const path = resolve(__dirname, `${args[0]}.js`);
      try {
        await utils.downloadFile(`https://drive.google.com/u/0/uc?id=${id}&export=download`, path);
        return api.sendMessage(`ƒê√£ th√™m code n√†y v√†o "${args[0]}.js" n·∫øu x·∫£y ra l·ªói th√¨ ƒë·ªïi file drive th√†nh txt nh√©!`, threadID);
      }
      catch(e) {
        return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code m·ªõi cho "${args[0]}.js".`, threadID);
      }
    }
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
    }
    case "UpCodeEvent": {
      api.unsendMessage(messageID);
      try {
        var name = args[0];
        if (name.indexOf('https://') !== -1) {
          return api.sendMessage(`Nh·∫≠p t√™n code ƒë·ªÉ down code`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "DownCodeEvent",
      name: this.config.name, 
      author: senderID,
      messageID: info.messageID,
      DownCodeEvent: name
            })
          })
        } else if (name) {
        var data = fs.readFile(
          `./modules/events/${args[0]}.js`,
          "utf-8",
          async (err, data) => {
            if (err) return api.sendMessage(`L·ªánh ${args[0]} kh√¥ng t·ªìn t·∫°i!.`, threadID);
            let client = new PasteClient("R02n6-lNPJqKQCd5VtL4bKPjuK6ARhHb");
            async function pastepin(name) {
              const url = await client.createPaste({
                code: data,
                expireDate: 'N',
                format: "javascript",
                name: name,
                publicity: 1
              });
              var id = url.split('/')[3]
              return 'https://pastebin.com/raw/' + id
            }
            var link = await pastepin(args[1] || 'noname')
            return api.sendMessage(link, threadID, messageID);
          }
        );
        return
    }
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
    }
    case "DownCodeEvent": {
      api.unsendMessage(messageID);
      try {
        var urlR = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/
    var url = handleReply.DownCodeEvent.match(urlR);
    if (url[0].indexOf('pastebin') !== -1 || url[0].indexOf('github') !== -1 || url[0].indexOf('phamvandien') !== -1) {
        axios.get(url[0]).then(i => {
            var data = i.data
            fs.writeFile(
                `./modules/events/${args[0]}.js`,
                data,
                "utf-8",
                function (err) {
                    if (err) return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code v√†o ${args[0]}.js`, threadID);
                    api.sendMessage(`ƒê√£ √°p d·ª•ng code v√†o ${args[0]}.js, s·ª≠ d·ª•ng event load ƒë·ªÉ s·ª≠ d·ª•ng!`, threadID);
                }
            );
        })
    }

    if (url[0].indexOf('buildtool') !== -1 || url[0].indexOf('tinyurl.com') !== -1) {
        const options = {
            method: 'GET',
            url: handleReply.DownCodeEvent
        };
        request(options, function (error, response, body) {
            if (error) return api.sendMessage('Vui l√≤ng ch·ªâ reply link (kh√¥ng ch·ª©a g√¨ kh√°c ngo√†i link)', threadID,);
            const load = cheerio.load(body);
            load('.language-js').each((index, el) => {
                if (index !== 0) return;
                var code = el.children[0].data
                fs.writeFile(`./modules/events/${args[0]}.js`, code, "utf-8",
                    function (err) {
                        if (err) return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code m·ªõi cho "${args[0]}.js".`, threadID);
                        return api.sendMessage(`ƒê√£ th√™m code n√†y v√†o "${args[0]}.js", s·ª≠ d·ª•ng event load ƒë·ªÉ s·ª≠ d·ª•ng!`, threadID);
                    }
                );
            });
        });
        return
    }
  
    if (url[0].indexOf('drive.google') !== -1) {
      var id = url[0].match(/[-\w]{25,}/)
      const path = resolve(`./modules/events/${args[0]}.js`);
      try {
        await utils.downloadFile(`https://drive.google.com/u/0/uc?id=${id}&export=download`, path);
        return api.sendMessage(`ƒê√£ th√™m code n√†y v√†o "${args[0]}.js" n·∫øu x·∫£y ra l·ªói th√¨ ƒë·ªïi file drive th√†nh txt nh√©!`, threadID);
      }
      catch(e) {
        return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code m·ªõi cho "${args[0]}.js".`, threadID);
      }
    }
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
    }
    case "UpHandle": {
      api.unsendMessage(messageID);
      try {
        var name = args[0];
        if (name.indexOf('https://') !== -1) {
          return api.sendMessage(`Nh·∫≠p t√™n handle ƒë·ªÉ down code`, threadID, (error, info) => {
    global.client.handleReply.push({
      type: "DownHandle",
      name: this.config.name, 
      author: senderID,
      messageID: info.messageID,
      DownHandle: name
            })
          })
        } else if (name) {
        var data = fs.readFile(
          `./includes/handle/${args[0]}.js`,
          "utf-8",
          async (err, data) => {
            if (err) return api.sendMessage(`L·ªánh ${args[0]} kh√¥ng t·ªìn t·∫°i!.`, threadID);
            let client = new PasteClient("R02n6-lNPJqKQCd5VtL4bKPjuK6ARhHb");
            async function pastepin(name) {
              const url = await client.createPaste({
                code: data,
                expireDate: 'N',
                format: "javascript",
                name: name,
                publicity: 1
              });
              var id = url.split('/')[3]
              return 'https://pastebin.com/raw/' + id
            }
            var link = await pastepin(args[1] || 'noname')
            return api.sendMessage(link, threadID, messageID);
          }
        );
        return
    }
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
    }
    case "DownHandle": {
      api.unsendMessage(messageID);
      try {
        var urlR = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/
    var url = handleReply.DownHandle.match(urlR);
    if (url[0].indexOf('pastebin') !== -1 || url[0].indexOf('github') !== -1 || url[0].indexOf('phamvandien') !== -1) {
        axios.get(url[0]).then(i => {
            var data = i.data
            fs.writeFile(
                `./includes/handle/${args[0]}.js`,
                data,
                "utf-8",
                function (err) {
                    if (err) return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code v√†o ${args[0]}.js`, threadID);
                    api.sendMessage(`ƒê√£ √°p d·ª•ng code v√†o ${args[0]}.js, restart ƒë·ªÉ s·ª≠ d·ª•ng!`, threadID);
                }
            );
        })
    }

    if (url[0].indexOf('buildtool') !== -1 || url[0].indexOf('tinyurl.com') !== -1) {
        const options = {
            method: 'GET',
            url: handleReply.DownHandle
        };
        request(options, function (error, response, body) {
            if (error) return api.sendMessage('Vui l√≤ng ch·ªâ reply link (kh√¥ng ch·ª©a g√¨ kh√°c ngo√†i link)', threadID,);
            const load = cheerio.load(body);
            load('.language-js').each((index, el) => {
                if (index !== 0) return;
                var code = el.children[0].data
                fs.writeFile(`./includes/handle/${args[0]}.js`, code, "utf-8",
                    function (err) {
                        if (err) return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code m·ªõi cho "${args[0]}.js".`, threadID);
                        return api.sendMessage(`ƒê√£ th√™m code n√†y v√†o "${args[0]}.js", restart ƒë·ªÉ s·ª≠ d·ª•ng!`, threadID);
                    }
                );
            });
        });
        return
    }
  
    if (url[0].indexOf('drive.google') !== -1) {
      var id = url[0].match(/[-\w]{25,}/)
      const path = resolve(`./includes/handle/${args[0]}.js`);
      try {
        await utils.downloadFile(`https://drive.google.com/u/0/uc?id=${id}&export=download`, path);
        return api.sendMessage(`ƒê√£ th√™m code n√†y v√†o "${args[0]}.js" n·∫øu x·∫£y ra l·ªói th√¨ ƒë·ªïi file drive th√†nh txt nh√©!`, threadID);
      }
      catch(e) {
        return api.sendMessage(`ƒê√£ x·∫£y ra l·ªói khi √°p d·ª•ng code m·ªõi cho "${args[0]}.js".`, threadID);
      }
    }
      } catch(e) {
        return api.sendMessage(e, threadID)
      }
    }
    //convert t·ª´ NTK 
    case "ChangeAvt": {
    api.unsendMessage(messageID)
    let imgUrl;
    if (body && body.match(/^((http(s?)?):\/\/)?([wW]{3}\.)?[a-zA-Z0-9\-.]+\.[a-zA-Z]{2,}(\.[a-zA-Z]{2,})?$/g))imgUrl = body;
    else if (event.attachments[0] && event.attachments[0].type == "photo") imgUrl = event.attachments[0].url;
    else return api.sendMessage(`Vui l√≤ng nh·∫≠p link h√¨nh ·∫£nh h·ª£p l·ªá ho·∫∑c ph·∫£n h·ªìi tin nh·∫Øn k√®m m·ªôt ·∫£nh mu·ªën ƒë·∫∑t l√†m avatar cho bot`, threadID, (err, info) => {
      global.client.handleReply.push({
        name: this.config.name,
        messageID: info.messageID,
        author: senderID,
        type: "ChangeAvt"
      })
    })
    try {
      const imgBuffer = (await axios.get(imgUrl, {
        responseType: "stream"
      })).data;
      const form0 = {
        file: imgBuffer
      };
      let uploadImageToFb = await api.httpPostFormData(`https://www.facebook.com/profile/picture/upload/?profile_id=${IDBot}&photo_source=57&av=${IDBot}`, form0);
      uploadImageToFb = JSON.parse(uploadImageToFb.split("for (;;);")[1]);
      if (uploadImageToFb.error) return api.sendMessage("ƒê√£ x·∫£y ra l·ªói: " + uploadImageToFb.error.errorDescription);
      const idPhoto = uploadImageToFb.payload.fbid;
      const form = {
        av: IDBot,
  			fb_api_req_friendly_name: "ProfileCometProfilePictureSetMutation",
  			fb_api_caller_class: "RelayModern",
  			doc_id: "5066134240065849",
  			variables: JSON.stringify({
          input: {
            caption: "",
            existing_photo_id: idPhoto,
            expiration_time: null,
            profile_id: IDBot,
            profile_pic_method: "EXISTING",
            profile_pic_source: "TIMELINE",
            scaled_crop_rect: {
              height: 1,
              width: 1,
              x: 0,
              y: 0
            },
            skip_cropping: true,
            actor_id: IDBot,
            client_mutation_id: Math.round(Math.random() * 19).toString()
          },
          isPage: false,
          isProfile: true,
          scale: 3
        })
      };
      api.httpPost("https://www.facebook.com/api/graphql/", form, (e, i) => {
        if (e) api.sendMessage(`ƒê√£ x·∫£y ra l·ªói, vui l√≤ng th·ª≠ l·∫°i sau`, threadID);
        else if (JSON.parse(i.slice(0, i.indexOf('\n') + 1)).errors) api.sendMessage(`ƒê√£ x·∫£y ra l·ªói: ${JSON.parse(i).errors[0].description}`,  threadID);
        else api.sendMessage(`ƒê√£ thay ƒë·ªïi avatar cho bot th√†nh c√¥ng`, threadID);
      });
    }
    catch(err) {
      api.sendMessage(`ƒê√£ x·∫£y ra l·ªói, vui l√≤ng th·ª≠ l·∫°i sau`, threadID);
    }
    }
  }
    }
